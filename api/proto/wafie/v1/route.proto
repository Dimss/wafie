syntax = "proto3";

import "buf/validate/validate.proto";

package wafie.v1;



enum UpstreamRouteType {
  UPSTREAM_ROUTE_TYPE_UNSPECIFIED = 0;
  UPSTREAM_ROUTE_TYPE_DOMAIN = 1;
  UPSTREAM_ROUTE_TYPE_PORT = 2;
}

enum PortStatusType {
  PORT_STATUS_TYPE_UNSPECIFIED = 0;
  PORT_STATUS_TYPE_ENABLED = 1;
  PORT_STATUS_TYPE_DISABLED = 2;
}

enum PortType {
  PORT_TYPE_UNSPECIFIED = 0;
  PORT_TYPE_SVC_PORT = 1;
  PORT_TYPE_CONTAINER_PORT = 2;
}

enum DiscoveryStatusType {
  DISCOVERY_STATUS_TYPE_UNSPECIFIED = 0;
  DISCOVERY_STATUS_TYPE_SUCCESS = 1;
  DISCOVERY_STATUS_TYPE_INCOMPLETE = 2;
  DISCOVERY_STATUS_TYPE_DISABLED = 3;
}

enum IngressType {
  INGRESS_TYPE_UNSPECIFIED = 0;
  INGRESS_TYPE_NGINX = 1;
  INGRESS_TYPE_ISTIO = 2;
  INGRESS_TYPE_OCP = 4;
}

message Ingress {
  string name = 1;
  string namespace = 2;
  string host = 3;
  int32 port = 4;
  string path = 5;
  int32 application_id = 6;
  IngressType ingress_type = 7;
  DiscoveryStatusType discovery_status = 8;
  string discovery_message = 9;
}

message Port  {
  uint32 number = 1;
  string name = 2;
  uint32 proxy_listening_port = 3;
  string description = 4;
  PortStatusType status = 5;
  PortType port_type = 6;
}

message Upstream {
  string svc_fqdn = 1 [(buf.validate.field).required = true];
  repeated string container_ips = 2;
  repeated Ingress ingresses = 3;
  repeated Port ports = 4;
  UpstreamRouteType upstream_route_type = 5;
}
// Create route
message CreateRouteRequest {
  Ingress ingress = 1 [(buf.validate.field).required = true];
  Upstream upstream = 2 [(buf.validate.field).required = true];
  repeated Port ports = 3;
}
message CreateRouteResponse{}
// Update route
message UpdateRouteRequest {
  optional Upstream upstream = 1;
  repeated Port ports = 2;
}
message UpdateRouteResponse {}
// List routes
message ListRoutesOptions{
  optional bool include_ingress = 1;
  optional string svc_fqdn = 2;
}
message ListRoutesRequest {
  optional ListRoutesOptions options = 1;
}
message ListRoutesResponse{
  repeated Upstream upstreams = 1;
}


service RouteService {
  rpc CreateRoute(CreateRouteRequest) returns(CreateRouteResponse);
  rpc UpdateRoute(UpdateRouteRequest) returns(UpdateRouteResponse);
  rpc ListRoutes(ListRoutesRequest) returns(ListRoutesResponse);

}